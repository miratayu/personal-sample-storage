import groovy.json.JsonOutput

pipeline {
  agent any

  environment {
    fileName = 'output.json'
    logName = 'test.log'
  }

  stages {
    stage('hello') {
      steps {
        script {
          def read_json = readJSON file: 'jenkins/contents_list.json'
          def result = add_json_contents(read_json['list'])
          writeFile(file: fileName, text: JsonOutput.toJson('results': result))
          def abc = "abc"
          echo "abc: ${abc.class}"
          def ghi = abc.indexOf("c")
          echo "ghi: ${ghi}"
          def test_text = "abc\ndef\nghi\n"
          echo "test_text: ${test_text.class}"
          echo "test_text: ${test_text.indexOf("\n")}"
          writeFile(file: logName, text: test_text)
        }
      }
    }
    stage('archive artifacts') {
      steps {
        archiveArtifacts fileName
        archiveArtifacts logName
      }
    }
  }
  post {
    success {
      cleanWs()
    }
  }
}

def add_json_contents(contents) {
  def added_contents = [:]
  contents.each { key, value ->
    added_contents[key] = value['value']
  }
  return added_contents
}
