pipeline {
  agent any

  environment {
    fileName = 'output.txt'
  }

  stages {
    stage('hello') {
      steps {
        scripts {
          def result = setup('hello world')
          writeFile(file: fileName, text: result)
        }
      }
    }
    stage('archive artifacts') {
      steps {
        archiveArtifacts fileName
      }
    }
  }
  post {
    success {
      cleanWs()
    }
  }
}

def setup(text) {
  echo text
  return text
}
