pipeline {
  agent any

  environment {
    fileName = 'output.json'
  }

  stages {
    stage('hello') {
      steps {
        script {
          def result = setup('abcde')
          writeFile(file: fileName, text: result.stripIndent())
        }
      }
    }
    stage('archive artifacts') {
      steps {
        archiveArtifacts fileName
      }
    }
  }
  post {
    success {
      cleanWs()
    }
  }
}

def setup(text) {
  echo text
  return """\
    {
      '${text}': 'x',
      'b': 'y'
    }
    """
}
