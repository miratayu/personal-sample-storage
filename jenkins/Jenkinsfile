pipeline {
  agent any

  environment {
    fileName = 'output.json'
  }

  stages {
    stage('hello') {
      steps {
        script {
          def read_json = readJSON file: "jenkins/contents_list.json"
          def result = add_json_contents(read_json['list'])
          def output_json = "{'results': {${result}}}"
          writeFile(file: fileName, text: output_json)
        }
      }
    }
    stage('archive artifacts') {
      steps {
        archiveArtifacts fileName
      }
    }
  }
  post {
    success {
      cleanWs()
    }
  }
}

def add_json_contents(contents) {
  def added_contents = ""
  contents.each { name_as_key, details ->
    added_contents += create_json_contents(name_as_key, details)
  }
  return added_contents
}

def create_json_contents(name_as_key, details) {
  echo 'Create'
  return "'${name_as_key}': ${details}"
}
